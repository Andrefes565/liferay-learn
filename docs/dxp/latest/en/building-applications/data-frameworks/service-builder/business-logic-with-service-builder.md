# Business Logic with Service Builder

Once you've [generated model, persistence, and service code](./service-builder-basics/generating-model-persistence-and-service-code.md) with Service Builder, you can begin adding business logic. Each entity generated by Service Builder contains a model implementation and local service implementation class. Your application's business logic can be implemented in these classes. The generated service later contains default methods that call CRUD operations from the persistence layer. Once you've added your business logic, running Service Builder again regenerates your application's interfaces and makes your new logic available for invocation.

# See the Example Project

1. Start Liferay DXP. If you don't already have a docker container, use

    ```bash
    docker run -it -m 8g -p 8080:8080 [$LIFERAY_LEARN_DXP_DOCKER_IMAGE$]
    ```

    If you're running a different Liferay Portal version or Liferay DXP, adjust the above command accordingly. 

1. Download and unzip [Business Logic with Service Builder](./liferay-e4g5.zip).

    ```bash
    curl https://learn.liferay.com/dxp/latest/en/building-applications/data-frameworks/service-builder/liferay-e4g5.zip -O
    ```

    ```bash
    unzip liferay-e4g5.zip
    ```

1. From the module root, build and deploy.

    ```bash
    ./gradlew deploy -Ddeploy.docker.container.id=$(docker ps -lq)
    ```

    ```{note}
    This command is the same as copying the deployed jars to /opt/liferay/osgi/modules on the Docker container.
    ```

1. Confirm the deployment in the Liferay Docker container console.

    ```bash
    STARTED com.acme.e4g5.api_1.0.0 [1034]
    STARTED com.acme.e4g5.service_1.0.0 [1035]
    STARTED com.acme.e4g5.web_1.0.0 [1036]
    ```

1. Verify that the example module is working. Open your browser to `https://localhost:8080`.

1. Deploy the E4G5 Portlet to a page. You can find the example portlet under Sample Widgets.

   ![Add the E4G5 Portlet to a page](./business-logic-with-service-builder/images/)

1. Try adding an entry by inputting a name and description (e.g. e4g5_name1 and e4g5_description1). Click `Add` and the new entry will be listed under `E4G5 Entries`. Take note of the `e4g5EntryId` number.

1. Next, try to update this entry but inputting the `e4g5EntryId` from the previous step and a new name and description. (e.g. 41804, e4g5_name2, e4g5_description2). Click `Update` and the entry is now updated.

1. Finally, delete the entry by inputting the `e4g5EntryId`. Click `Delete` and the entry is now deleted.

## Update the Service Layer

Extend the local service by adding methods that can add, update and delete `E4G5Entry` entries.

### Implement the Add Method

1. Declare an `add*` method with parameters for creating an entity.

```{literalinclude} ./business-logic-with-service-builder/resources/liferay-e4g5.zip/e4g5-service/src/main/java/com/acme/e4g5/service/impl/E4G5EntryLocalServiceImpl.java
:language: java
:lines: 34-44
```

1. The `*Persistence` class associated with your entity has a `create()` method that constructs an entity instance with the given ID. Every `*BaseLocalServiceImpl` has a `counterLocalService` object for the entity. Invoke the counter service's `increment()` method to generate a primary ket for your entity instance.

1. Use the entity's setter methods to populate your entity's attributes. The sample sets the two attributes `name` and `description`.

1. Invoke the `update()` method of the `*Persistence` class, passing in the entity object.

### Implement the Update Method

1. Declare an `update*` method with parameters for updating an entity. The sample receives the two attributes `name` and `description` and also receives `e4g5EntryId`.

```{literalinclude} ./business-logic-with-service-builder/resources/liferay-e4g5.zip/e4g5-service/src/main/java/com/acme/e4g5/service/impl/E4G5EntryLocalServiceImpl.java
:language: java
:lines: 54-65
```

1. Use the `findByPrimaryKey()` method of the `*Persistence` class to retrieve the entity instance by entry ID.

1. Use the entity's setter methods to populate your entity's attributes.

1. Invoke the `update()` method of the `*Persistence` class, passing in the entity object.

### Implement the Delete Method

1. Declare a `delete*` method that receives the entry ID of the entity.

```{literalinclude} ./business-logic-with-service-builder/resources/liferay-e4g5.zip/e4g5-service/src/main/java/com/acme/e4g5/service/impl/E4G5EntryLocalServiceImpl.java
:language: java
:lines: 46-52
```

1. Invoke the `delete()` method of the `*Persistence` class, passing in the entity object.

After implementing your `add*`, `update*`, and `delete*` methods, run Service Builder to propagate your new service methods to the `*LocalService` interface.

## Add Actions to Your Portlet

